<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>MongoDB: Setting TTL on Documents by Kevin Griffin</title><meta name="gridsome:hash" content="782414107f461c86c0093807ec9a7009f522142f"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.11"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="96x96" href="/assets/static/favicon.b9532cc.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/assets/static/favicon.f22e9f3.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="152x152" href="/assets/static/favicon.62d22cb.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="120x120" href="/assets/static/favicon.1539b60.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="167x167" href="/assets/static/favicon.dc0cdc5.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="180x180" href="/assets/static/favicon.7b22250.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mali:700|Nunito"><link rel="preload" href="/assets/css/0.styles.dc844d61.css" as="style"><link rel="preload" href="/assets/js/app.a597a7b1.js" as="script"><link rel="preload" href="/assets/js/page--src-templates-article-vue.fe6cfc9d.js" as="script"><link rel="prefetch" href="/assets/js/page--node-modules-gridsome-app-pages-404-vue.e4711ebb.js"><link rel="prefetch" href="/assets/js/page--src-pages-index-vue.e8d64122.js"><link rel="stylesheet" href="/assets/css/0.styles.dc844d61.css"><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body >
    <div data-server-rendered="true" id="app" class="layout"><header class="header"><a href="/" class="heading-link active"><h6 class="heading"></h6></a></header><div class="article"><h1>MongoDB: Setting TTL on Documents</h1><span>October 13, 2014</span><div class="content"><p>On some recent work I was doing with <a href="http://winsitter.com" target="_blank" rel="nofollow noopener noreferrer">Winsitter</a>, I needed an approach that would systematically remove documents after a specified period of time within MongoDB.</p>
<p>Previously, I would have written cron jobs or helpers to clean up the old data.  No longer!</p>
<p>Come to discover, this feature <a href="http://docs.mongodb.org/manual/tutorial/expire-data/" target="_blank" rel="nofollow noopener noreferrer">already exists</a> inside of MongoDB.  It is called setting the TTL or Time to Live of a document.</p>
<p>The process involves creating an index on the date object you'd like to watch.  In the example below, I am providing a property on my document called <code>auditDate</code>.  I want the document associated with that property to automatically remove itself after 5 days or <em>432000000</em> miliseconds.</p>
<pre><code>dbConnection
.collection("audit")
.ensureIndex({
    "auditDate": 1
}, {
    expireAfterSeconds: 432000000 // 5 days
}, function(indexErr) {
    if (indexErr) {
        console.log("error creating index");
        console.log(indexErr);
    }
});
</code></pre>
<p>In the example, I'm using the MongoDB node.js library to ensure an index exists.  If the index doesn't exist, MongoDB will create it.</p>
<p>The <code>expireAfterSeconds</code> options tells MongoDB that after a specified amount of time, the document should automatically remove itself.</p>
<p>This quick fix has saved me a ton of time, and I am hoping it saves a ton for you too!</p>
</div></div></div>
    <script>window.__INITIAL_STATE__={"data":{"article":{"id":"e7324cc33e76c2495d339bfba0a8efc4","title":"MongoDB: Setting TTL on Documents","date":"October 13, 2014","categories":["Development"],"permalink":"mongodb-setting-ttl-on-documents","content":"\u003Cp\u003EOn some recent work I was doing with \u003Ca href=\"http:\u002F\u002Fwinsitter.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003EWinsitter\u003C\u002Fa\u003E, I needed an approach that would systematically remove documents after a specified period of time within MongoDB.\u003C\u002Fp\u003E\n\u003Cp\u003EPreviously, I would have written cron jobs or helpers to clean up the old data.  No longer!\u003C\u002Fp\u003E\n\u003Cp\u003ECome to discover, this feature \u003Ca href=\"http:\u002F\u002Fdocs.mongodb.org\u002Fmanual\u002Ftutorial\u002Fexpire-data\u002F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003Ealready exists\u003C\u002Fa\u003E inside of MongoDB.  It is called setting the TTL or Time to Live of a document.\u003C\u002Fp\u003E\n\u003Cp\u003EThe process involves creating an index on the date object you'd like to watch.  In the example below, I am providing a property on my document called \u003Ccode\u003EauditDate\u003C\u002Fcode\u003E.  I want the document associated with that property to automatically remove itself after 5 days or \u003Cem\u003E432000000\u003C\u002Fem\u003E miliseconds.\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode\u003EdbConnection\n.collection(\"audit\")\n.ensureIndex({\n    \"auditDate\": 1\n}, {\n    expireAfterSeconds: 432000000 \u002F\u002F 5 days\n}, function(indexErr) {\n    if (indexErr) {\n        console.log(\"error creating index\");\n        console.log(indexErr);\n    }\n});\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EIn the example, I'm using the MongoDB node.js library to ensure an index exists.  If the index doesn't exist, MongoDB will create it.\u003C\u002Fp\u003E\n\u003Cp\u003EThe \u003Ccode\u003EexpireAfterSeconds\u003C\u002Fcode\u003E options tells MongoDB that after a specified amount of time, the document should automatically remove itself.\u003C\u002Fp\u003E\n\u003Cp\u003EThis quick fix has saved me a ton of time, and I am hoping it saves a ton for you too!\u003C\u002Fp\u003E\n"}},"context":{}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script><script src="/assets/js/app.a597a7b1.js" defer></script><script src="/assets/js/page--src-templates-article-vue.fe6cfc9d.js" defer></script>
  </body>
</html>
